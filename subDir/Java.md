## Java

### 多线程

1. 线程
   状态：NEW、RUNNABLE、BLOCKED、WAITING、TERMINATED

2. 线程池

   优点：

   - 节省开销。线程池中的线程可以重复利用。
   - 速度快。任务来了就能开始，省去了创建线程的时间。
   - 线程可控。线程数量可控和任务可控。
   - 功能强大。可以定时和重复执行任务。

   构造函数参数：

   - corePoolSize: 核心线程数量，不会释放。
   - maximumPoolSize：允许使用的最大线程数量。=核心线程数+非核心线程数。
   - keepAliveTime：闲置线程允许的最大闲置时间。
   - unit：闲置时间的单位。
   - workQueue: 阻塞队列，不同阻塞队列有不同的特性。

   四种类型的线程池：

   - CachedThreadPool：闲置线程超时会释放，没有闲置线程的情况下，每次都会创建新的线程。
   - FixedThreadPool：线程池只能存放指定数量的线程池，线程不会释放，可重复利用。
   - SingleThreadExecutor：单线程的线程池。
   - ScheduledThreadPool：可定时和重复执行的线程池。

   工作流程：

   1. 任务来了，优先考虑核心线程。
   2. 核心线程满了，进入阻塞队列。
   3. 阻塞队列满了，考虑非核心线程。
   4. 非核心线程满了，再触发拒绝任务。

3. 锁

   死锁

   synchronized：

   - 修饰方法

   - 修饰代码块。需要提供锁对象，可以是类对象，也可以是其他实例对象。

     成员方法锁住实例对象，静态方法锁住类对象。

   原理：

   - 代码块同步：在编译后的字节码其实位置插入 monitorenter 指令, 代码块结束和异常处插入 monitorexit。
   - 方法同步：会在方法结构上加一个锁标记，线程在执行的时候获取对应的锁。
